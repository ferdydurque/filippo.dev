var rahe;if(rahe){if("object"!==typeof rahe)throw Error("rahe already exists and not an object");}else rahe={};if(rahe.sis){if("object"!==typeof rahe.sis)throw Error("rahe.sis already exists and not an object");}else rahe.sis={};
rahe.sis.regenerate={post_types:[],thumbnails:[],list:{},cur:0,timeScript:[],dateScript:"",percent:"",percentText:null,progress:null,messageZone:null,time:null,timeZone:null,buttonRegenerate:null,errorZone:null,errorMessages:null,thumb:null,thumbImg:null,init:function(){this.percentText=jQuery("#sis_progress-percent");this.progress=jQuery(".progress");this.messageZone=jQuery("#regenerate_message");this.time=jQuery("#time");this.timeZone=this.time.find("p span.time_message");this.buttonRegenerate=
jQuery("#ajax_thumbnail_rebuild");this.errorZone=jQuery("#error_messages");this.errorMessages=this.errorZone.find("ul.messages");this.thumb=jQuery("#thumb");this.thumbImg=jQuery("#thumb-img")},getThumbnails:function(){var a=this,b=jQuery("input.thumbnails:checked");b.length!=jQuery('input.thumbnails[type="checkbox"]').length&&b.each(function(){a.thumbnails.push(this.value)})},getPostTypes:function(){var a=this,b=jQuery("input.post_types:checked");b.length!=jQuery('input.post_types[type="checkbox"]').length&&
b.each(function(){a.post_types.push(this.value)})},setMessage:function(a){this.messageZone.html("<p>"+a+"</p>").addClass("updated").addClass("fade").show();this.refreshProgressBar()},setTimeMessage:function(a){this.timeZone.html(a)},refreshProgressBar:function(){this.progress.progressbar()},checkStartRegenerating:function(){if(0<jQuery(".notSaved").size())if(!0==confirm(sis.notSaved))this.startRegenerating();else return!1;else this.startRegenerating()},startRegenerating:function(){var a=this,b=jQuery("input.getList").val();
a.getThumbnails();a.getPostTypes();this.dateScript=new Date;jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:{action:"sis_get_list",post_types:a.post_types,nonce:b},beforeSend:function(){a.buttonRegenerate.attr("disabled",!0);a.setMessage(sis.reading)},success:function(b){if("object"!==typeof b)return a.reInit(),a.setMessage(sis.phpError),!1;a.time.show();a.list=b;a.curr=0;a.progress.show();a.regenItem()}})},regenItem:function(){var a=this,b=jQuery("input.regen").val();if(!this.list)return this.reInit(),
this.setMessage(sis.noMedia),!1;this.curr>=this.list.length?(b=new Date,this.reInit(),this.setMessage(sis.done+this.curr+" "+sis.messageRegenerated+sis.startedAt+" "+this.dateScript.getHours()+":"+this.dateScript.getMinutes()+":"+this.dateScript.getSeconds()+sis.finishedAt+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds())):(this.setMessage(sis.regenerating+(this.curr+1)+sis.of+this.list.length+" ("+this.list[this.curr].title+")..."),jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:{action:"sis_rebuild_image",
id:this.list[this.curr].id,thumbnails:this.thumbnails,nonce:b},beforeSend:function(){a.percent=100*(a.curr/a.list.length);a.progress.progressbar("value",a.percent);a.percentText.removeClass("hidden").html(Math.round(a.percent)+"%")},success:function(b){if(!b.src||!b.time||b.error||"object"!==typeof b){var e="",e="object"!==typeof b?sis.phpError:b.error;a.errorZone.addClass("error message");a.errorMessages.prepend("<li>"+e+"</li>")}else{b.message&&a.time.find("ul.messages").prepend("<li>"+b.message+
"</li>");a.thumb.show();a.thumbImg.attr("src",b.src);var e=new Date,g=new Date,f=0,c=0,j=0;a.timeScript.push(b.time);f=a.timeScript.length;for(j;j<f;j++)c+=a.timeScript[j];b=Math.round(1E3*c/f*a.list.length);e.setTime(a.dateScript.getTime()+b);b=a.s2t(Math.abs(e.getTime()-g.getTime())/1E3);a.setTimeMessage(e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+sis.or+b+sis.beforeEnd)}a.curr++;a.regenItem()}}))},s2t:function(a){a%=86400;var b=new Date(1970,0,1),d=0;b.setSeconds(a);d=b.toTimeString().substr(0,
8);86399<a&&(d=Math.floor((b-Date.parse("1/1/70"))/36E5)+d.substr(2));return d},reInit:function(){this.buttonRegenerate.removeAttr("disabled");this.thumb.hide();this.progress.hide();this.percentText.addClass("hidden")}};
rahe.sis.sizes={i:0,add:function(a,b){a.preventDefault();var d=_.template(document.getElementById("sis-new_size").text,{size_id:this.i,validate:sis.validate});jQuery(b).closest("tr").before(d);this.i++},register:function(a,b){a.preventDefault();var d=jQuery(b).closest("tr").children("th").find("input").val(),e=jQuery(b).closest("tr").children("th").find("input").attr("id"),g=jQuery(b).closest("tbody").find('input[value="'+d+'"]').length;if("thumbnail"==d||"medium"==d||"large"==d)return alert(sis.notOriginal),
!1;if(0!=g)return alert(sis.alreadyPresent),!1;d=_.template(document.getElementById("sis-new_size_row").text,{size:sis.size,size_name:d,maximumWidth:sis.maximumWidth,maximumHeight:sis.maximumHeight,customName:sis.customName,crop:sis.crop,show:sis.show,deleteImage:sis.deleteImage,validateButton:sis.validateButton});jQuery("#"+e).closest("tr").html(d);this.setButtons()},deleteSize:function(a,b){a.preventDefault();!0==confirm(sis.confirmDelete)&&(jQuery(b).closest("tr").remove(),this.ajaxUnregister(b))},
getPhp:function(a,b){a.preventDefault();var d=jQuery(b).closest("tr");jQuery.ajax({url:sis.ajaxUrl,type:"POST",data:{action:"sis_get_sizes"},beforeSend:function(){d.removeClass("addPending");d.addClass("addPending")},success:function(a){jQuery("#get_php").nextAll("code").html("<br />"+a).show().css({display:"block"});d.removeClass("addPending")}})},ajaxRegister:function(a,b){a.preventDefault();var d=this,e=jQuery(b).closest("table"),g,f=jQuery(".addSize").val(),c=jQuery(b).closest("tr"),j=c.find('input[name="image_name"]').val(),
k=c.find("label.c").hasClass("ui-state-active"),l=c.find("label.s").hasClass("ui-state-active"),m=c.find("input.n").val();w=h=0;k=!1==k||void 0==k?!1:!0;l=!1==l||void 0==l?!1:!0;w=parseInt(c.find("input.w").val());h=parseInt(c.find("input.h").val());e.hasClass("ajaxing")||jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:{action:"sis_add_size",width:w,height:h,crop:k,name:j,show:l,customName:m,nonce:f},beforeSend:function(){c.removeClass();c.addClass("addPending");e.addClass("ajaxing")},
success:function(a){var b="";c.removeClass();e.removeClass("ajaxing");0==a?b="errorAdding":(b=2==a?"notChangedAdding":"successAdding",d.addToArray(j,w,h,k,b));c.find("input.h").attr({base_h:h});c.find("input.w").attr({base_w:w});c.find("input.c").attr({base_c:k});c.find("input.s").attr({base_s:l});c.addClass(b);c.find("td").removeClass("notSaved");c.find(".add_size").removeClass("validate_size").hide().children(".ui-button-text").text(sis.update);clearTimeout(g);g=setTimeout(function(){c.removeClass("errorAdding notChangedAdding successAdding")},
3E3)}})},ajaxUnregister:function(a){var b=this,d=jQuery(a).closest("tr").find('input[name="image_name"]').val(),e=jQuery(a).closest("tr").find("input.deleteSize").val();jQuery.ajax({url:sis.ajaxUrl,type:"POST",data:{action:"sis_remove_size",name:d,nonce:e},success:function(){b.removeFromArray(a)}})},addToArray:function(a,b,d,e,g){var f=jQuery("#sis-"+a),c="",j,c=0!=f.length?f.closest("tr"):jQuery("#sis-regen .wrapper > table#sis_sizes > tbody > tr:first").clone().attr("id","sis-"+a);e=!0==e?sis.tr:
sis.fl;c.find("th > label").attr("for",a).end().find("input.thumbnails").val(a).attr("id",a).end().find("th:nth-child(2) > label").text(a).end().find("th:nth-child(3) > label").text(b+"px").end().find("th:nth-child(4) > label").text(d+"px").end().find("th:nth-child(5) > label").text(e);0==f.length&&c.appendTo("#sis-regen .wrapper > table#sis_sizes > tbody");c.removeClass("errorAdding notChangedAdding successAdding").addClass(g);clearTimeout(j);j=setTimeout(function(){c.removeClass("errorAdding notChangedAdding successAdding")},
3E3)},removeFromArray:function(a){a=jQuery(a).closest("tr").find("input[name=image_name]").val();jQuery("#sis-"+a).remove()},setButtons:function(){jQuery(".delete_size").button({icons:{primary:"ui-icon-circle-close"},text:!0});jQuery(".add_size").button({icons:{primary:"ui-icon-check"},text:!0});jQuery(".crop").button({icons:{primary:"ui-icon-arrow-4-diag"},text:!0});jQuery(".show").button({icons:{primary:"ui-icon-lightbulb"},text:!0});jQuery(".size_options").buttonset()},displayChange:function(a){a=
jQuery(a);var b=a.closest("tr");if(b.hasClass("new_size"))return!1;var d=b.find("input.h"),e=b.find("input.w"),g=b.find("input.c"),f=b.find("input.s"),c=b.find("input.n"),j=d.val(),k=e.val(),l=b.find("label.c").hasClass("ui-state-active"),b=b.find("label.s").hasClass("ui-state-active"),m=c.val(),d=d.attr("base_h"),e=e.attr("base_w"),g=g.attr("base_c"),f=f.attr("base_s"),c=c.attr("base_n");j!=d||k!=e||l!=("0"==g?!1:!0)||b!=("0"==f?!1:!0)||m!=c?a.closest("td").addClass("notSaved").find(".add_size").css("display",
"inline-block"):a.closest("td").removeClass("notSaved").find(".add_size").css("display","none")}};
jQuery(function(){rahe.sis.regenerate.init();var a=jQuery("#wpbody-content");jQuery("#ajax_thumbnail_rebuild").click(function(){rahe.sis.regenerate.checkStartRegenerating()});a.on("click","#add_size",function(a){rahe.sis.sizes.add(a,this)}).on("click",".add_size_name",function(a){rahe.sis.sizes.register(a,this)}).on("click",".delete_size",function(a){rahe.sis.sizes.deleteSize(a,this)}).on("click",".add_size",function(a){rahe.sis.sizes.ajaxRegister(a,this)}).on("click keyup change",".h,.w,.c,.s,.n",
function(){rahe.sis.sizes.displayChange(this)}).on("click","#get_php",function(a){rahe.sis.sizes.getPhp(a,this)});jQuery("#get_php").nextAll("code").hide();jQuery(".add_size").hide();rahe.sis.sizes.setButtons()});